{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-11T13:27:37.859Z",
  "summary": "Diff adds a Motoko migration and substantial frontend wiring for listings, catalogue, cart, and checkout. However, the backend diff excerpt only clearly shows new/updated listing-related types and migration plumbing; the required backend behaviours (admin CRUD enforcement, promo-active pricing rule, shopper catalogue filtering, and order creation/stock decrement) are not evidenced in the provided backend diff summary. The diff also includes many unrelated UI/theme/landing-page changes not requested by the BuildRequest.",
  "missing_requirements": [
    {
      "id": "REQ-7",
      "requirement": "Backend uniqueness enforcement for one listing per (retailerId, productId) with clear trap message, and deterministic promo-active pricing rule.",
      "reason": "backend/main.mo excerpt shows new Listing/Promo types, but no evidence of uniqueness index/checks or promo-active evaluation logic in the provided diff summary.",
      "evidence": [
        "backend/main.mo (truncated)"
      ]
    },
    {
      "id": "REQ-8",
      "requirement": "Backend admin-only CRUD APIs for listings (create/update/delete/list with filters) and non-admin rejection.",
      "reason": "Frontend hooks call actor methods (e.g., listAllListings/createListing/updateListing/deleteListing), but the backend diff excerpt does not show these method implementations or any admin authorization checks for them.",
      "evidence": [
        "frontend/src/hooks/useListings.ts",
        "backend/main.mo (truncated)"
      ]
    },
    {
      "id": "REQ-9",
      "requirement": "Backend shopper-facing catalogue query API returning products augmented with only orderable listings and promo pricing data (activePrice + savings).",
      "reason": "Frontend calls actor.getCatalogue() and expects ShopProduct/ShopListing fields, but the backend diff excerpt does not show an implemented getCatalogue method nor the filtering logic (active + in-stock) described by the requirement.",
      "evidence": [
        "frontend/src/hooks/useCatalog.ts",
        "backend/main.mo (truncated)"
      ]
    },
    {
      "id": "REQ-10",
      "requirement": "Backend order creation using listing IDs with orderability validation, active-price totals, atomic stock decrement, and customer order query APIs.",
      "reason": "Frontend calls actor.createOrder(), actor.getMyOrders(), and actor.getOrder(), but the backend diff excerpt does not evidence these methods nor the required validation/stock decrement/total computation logic.",
      "evidence": [
        "frontend/src/hooks/useOrders.ts",
        "backend/main.mo (truncated)"
      ]
    },
    {
      "id": "REQ-11",
      "requirement": "Reconstruct any newly introduced lookup/index structures for listings uniqueness (retailerId, productId) during migration.",
      "reason": "backend/migration.mo maps old listings to new listings with promo=null and updatedAt set, but shows no reconstruction of any additional indices/lookup maps for enforcing (retailerId, productId) uniqueness.",
      "evidence": [
        "backend/migration.mo"
      ]
    },
    {
      "id": "REQ-12",
      "requirement": "Frontend admin listings UI validation/error handling for duplicate retailer+product listings and promo field validation.",
      "reason": "Admin page and dialog show toast usage, but the provided excerpts do not show handling of duplicate retailer+product backend trap messages specifically (mapping to user-friendly toast), and useListings.ts is truncated before promo/validation-related mutations complete.",
      "evidence": [
        "frontend/src/pages/admin/AdminManageListingsPage.tsx (truncated)",
        "frontend/src/components/admin/ListingEditDialog.tsx (truncated)",
        "frontend/src/hooks/useListings.ts (truncated)"
      ]
    },
    {
      "id": "REQ-13",
      "requirement": "Listing editor prevents promo price >= normal price and displays computed savings (normal - promo).",
      "reason": "ListingEditDialog adds promo inputs and loads promo state, but the excerpt does not show the savings calculation UI nor the validation preventing promoPrice >= normalPrice.",
      "evidence": [
        "frontend/src/components/admin/ListingEditDialog.tsx (truncated)"
      ]
    },
    {
      "id": "REQ-15",
      "requirement": "Checkout shows clear user-facing error if backend validation fails (e.g., item became out-of-stock) without crashing.",
      "reason": "CheckoutPage catches errors and displays a generic toast; the excerpt does not show specific handling for out-of-stock errors or mapping backend trap messages into clearer customer-facing messages.",
      "evidence": [
        "frontend/src/pages/shop/CheckoutPage.tsx (truncated)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Broad UI/theme redesign and landing-page enhancements (African-inspired color system, shadows, typography, hero/landing changes) beyond wiring listings/catalogue/checkout.",
      "reason": "Not requested in BuildRequest; appears as additional styling/marketing changes.",
      "evidence": [
        "frontend-file-summaries.txt"
      ]
    },
    {
      "description": "Addition of generated logo/hero assets in frontend/public/assets/generated.",
      "reason": "BuildRequest did not request new branding assets.",
      "evidence": [
        "frontend-file-summaries.txt"
      ]
    },
    {
      "description": "New/expanded retailer portal hooks (getMyRetailer, getMyRetailerInventory, getMyRetailerOrders).",
      "reason": "BuildRequest scope focuses on listings admin, shopper catalogue, and checkout orderability; retailer portal APIs/hooks were not requested.",
      "evidence": [
        "frontend/src/hooks/useRetailerPortal.ts"
      ]
    }
  ],
  "confidence": 0.62,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/admin/ListingEditDialog.tsx",
    "frontend/src/components/admin/SearchableSelect.tsx",
    "frontend/src/components/shop/ShopHeader.tsx",
    "frontend/src/components/shop/cart/CartProvider.tsx",
    "frontend/src/hooks/useCatalog.ts",
    "frontend/src/hooks/useListings.ts",
    "frontend/src/hooks/useOrders.ts",
    "frontend/src/hooks/useRetailerPortal.ts",
    "frontend/src/pages/admin/AdminManageListingsPage.tsx",
    "frontend/src/pages/shop/CartPage.tsx",
    "frontend/src/pages/shop/CataloguePage.tsx",
    "frontend/src/pages/shop/CheckoutPage.tsx",
    "frontend/src/pages/shop/MyOrdersPage.tsx",
    "frontend/src/pages/shop/OrderDetailPage.tsx",
    "project_state.json"
  ]
}