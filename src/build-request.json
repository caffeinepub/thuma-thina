{
  "kind": "build_request",
  "title": "Enforce mandatory default town requirement for all users",
  "projectName": "Thuma Thina",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Modify ProfileSetupDialog to make the default town field mandatory and prevent dialog dismissal until a town is selected",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "new users have to complete town field in profile setup to register on the app"
        ]
      },
      "acceptanceCriteria": [
        "ProfileSetupDialog cannot be dismissed or closed until a default town is selected",
        "Form validation prevents submission without a default town",
        "User cannot proceed to use the app without completing town selection"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add authentication flow check that displays DefaultTownSetupDialog immediately after login for users who have a profile but no default town set",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "they should be directed to profile set up shown modal to select a town",
          "after log in"
        ]
      },
      "acceptanceCriteria": [
        "After successful login, check if user has a profile with no default town",
        "Show DefaultTownSetupDialog modal when user lacks a default town",
        "Modal cannot be dismissed until town is selected",
        "User cannot access any app features until town is set"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update ShopLayout to render DefaultTownSetupDialog for authenticated users with profiles but no default town, preventing access to underlying content until town is selected",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "they should be directed to profile set up shown modal to select a town"
        ]
      },
      "acceptanceCriteria": [
        "DefaultTownSetupDialog appears as a blocking modal when user has profile but no default town",
        "Dialog cannot be dismissed or bypassed",
        "After town selection, dialog closes and user can access the app normally"
      ]
    }
  ],
  "constraints": [
    "Do not modify backend schema or Motoko code",
    "Preserve existing ProfileSetupDialog and DefaultTownSetupDialog components",
    "Do not change authentication flow in useInternetIdentity hook",
    "Maintain compatibility with existing user profile structure that includes defaultTown field"
  ],
  "nonGoals": [
    "Changing the backend UserProfile type or migration logic",
    "Modifying town management backend methods",
    "Adding new town-related database fields",
    "Implementing town selection UI redesign beyond requirement enforcement"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}